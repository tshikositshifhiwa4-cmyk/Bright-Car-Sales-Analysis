SELECT *
FROM BRIGHT.CAR.SALES
LIMIT 10;
------------------------------------------------------------------------------------------------
--GENERAL CHECKS
SELECT MIN (YEAR)
FROM BRIGHT.CAR.SALES;

SELECT MAX (YEAR)
FROM BRIGHT.CAR.SALES;

SELECT DISTINCT (MAKE)
FROM BRIGHT.CAR.SALES;

SELECT DISTINCT (MODEL)
FROM BRIGHT.CAR.SALES;

SELECT DISTINCT (TRIM)
FROM BRIGHT.CAR.SALES;

SELECT DISTINCT (STATE)
FROM BRIGHT.CAR.SALES;
------------------------------------------------------------------------------------------------
-- Convert text-based prices (e.g., ‘15,000’) to numeric format. AND REPLACE NULL with None

CREATE OR REPLACE TABLE BRIGHT.CAR.SALES AS
SELECT 
  YEAR,
  VIN,
  STATE,
  CONDITION,
  ODOMETER,
SUM(MMR) AS COST_PRICE,
IFNULL(MAKE, 'None') AS MAKE,
IFNULL(MODEL, 'None') AS MODEL,
IFNULL(TRIM, 'None') AS TRIM,
IFNULL(BODY, 'None') AS BODY,
IFNULL(TRANSMISSION, 'None') AS TRANSMISSION,
IFNULL(COLOR, 'None') AS COLOR,
IFNULL (INTERIOR, 'None') AS INTERIOR,
IFNULL (SELLER, 'None') AS SELLER,
REPLACE(SELLINGPRICE, ',', '') AS SELLINGPRICE,
SALEDATE,
SUM(SELLINGPRICE) AS SELLINGPRICE_TOTAL,
COUNT(*) AS UNITS_SOLD,
SUM(TRY_TO_NUMBER(REPLACE(SELLINGPRICE, ',', ''))) AS TOTAL_REVENUE,
ROUND ((SELLINGPRICE_TOTAL - COST_PRICE) / SELLINGPRICE_TOTAL * 100, 2) AS PROFIT_MARGIN,
  CASE
        WHEN PROFIT_MARGIN BETWEEN 0 AND 24.99  THEN 'Low Margin'
        WHEN PROFIT_MARGIN BETWEEN 25 AND 49.99 THEN 'Medium Margin'
        WHEN PROFIT_MARGIN >= 50 THEN 'High Margin'
        ELSE 'Negative Margin'
    END AS PERFORMANCE_TIER
      FROM BRIGHT.CAR.SALES
    GROUP BY ALL;
    -- Revenue by car make and model
    SELECT MAKE,
           MODEL,
         SUM (TOTAL_REVENUE),
         FROM BRIGHT.CAR.SALES
    GROUP BY ALL;
    --Sales distribution by year and Transmission
    SELECT
    YEAR ,
    TRANSMISSION,
    COUNT(*) AS UNITS_SOLD,
   SUM (TOTAL_REVENUE)
 FROM BRIGHT.CAR.SALES
GROUP BY ALL;
--Regional performance (city or province)
SELECT DISTINCT STATE,
                SUM (TOTAL_REVENUE)
FROM BRIGHT.CAR.SALES
GROUP BY STATE;
--Average selling price trends over time
SELECT SALEDATE,
     SELLINGPRICE
FROM BRIGHT.CAR.SALES
ORDER BY SALEDATE ASC;
--Profit_Margin = (Selling_Price - Cost_Price) / Selling_Price * 100 AND categorize cars by performance tiers (e.g., High Margin, Medium Margin, Low Margin).
SELECT YEAR,
    MAKE,
    MODEL,
    SUM(MMR) AS COST_PRICE,
    SUM(SELLINGPRICE) AS TOTAL_SELLING,
   ROUND ((TOTAL_SELLING - COST_PRICE) / TOTAL_SELLING * 100, 2) AS PROFIT_MARGIN,
  CASE
        WHEN PROFIT_MARGIN BETWEEN 0 AND 24.99  THEN 'Low Margin'
        WHEN PROFIT_MARGIN BETWEEN 25 AND 49.99 THEN 'Medium Margin'
        WHEN PROFIT_MARGIN >= 50 THEN 'High Margin'
        ELSE 'Negative Margin'
    END AS PERFORMANCE_TIER
FROM BRIGHT.CAR.SALES
GROUP BY YEAR,MAKE, MODEL
ORDER BY PROFIT_MARGIN DESC;
